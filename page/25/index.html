<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="mask-icon" href="/logo.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"leadscloud.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"F1YESSIUKA","apiKey":"fba180e0d225a86fe382bf021a9f0ae3","indexName":"blog","hits":{"per_page":10}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
<meta property="og:type" content="website">
<meta property="og:title" content="leadscloud">
<meta property="og:url" content="https://leadscloud.github.io/page/25/index.html">
<meta property="og:site_name" content="leadscloud">
<meta property="og:description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ray">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://leadscloud.github.io/page/25/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/25/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>leadscloud</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6GCT2E7T9Y"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-6GCT2E7T9Y","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="leadscloud" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">leadscloud</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Google SEO|外贸营销推广</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">266</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">11</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">459</span></a></li><li class="menu-item menu-item-免费chatgpt"><a href="https://freegpt.tech/?refer=blog-side" rel="section" target="_blank"><i class="fa fa-heart fa-fw"></i>免费ChatGPT</a></li><li class="menu-item menu-item-我的简历"><a href="https://leadscloud.github.io/resume/resume.pdf" rel="section"><i class="fa fa-vcard fa-fw"></i>我的简历</a></li><li class="menu-item menu-item-友情链接"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友情链接</a></li><li class="menu-item menu-item-chrome扩展（域名所属人）"><a href="/serp-analyzer/" rel="section"><i class="fa fa-cloud fa-fw"></i>Chrome扩展（域名所属人）</a></li><li class="menu-item menu-item-询盘管理系统"><a href="https://github.com/leadscloud/infomaster" rel="section" target="_blank"><i class="fa fa-database fa-fw"></i>询盘管理系统</a></li><li class="menu-item menu-item-外贸留言板系统"><a href="/20180615/google-seo-inquiry-messageboard/" rel="section"><i class="fa fa-database fa-fw"></i>外贸留言板系统</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fab fa-algolia fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ray</p>
  <div class="site-description" itemprop="description">熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">459</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">266</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/leadscloud" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;leadscloud" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:love4026@gmail.com" title="E-Mail → mailto:love4026@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://cdn.livechatinc.xyz/" title="https:&#x2F;&#x2F;cdn.livechatinc.xyz&#x2F;" rel="noopener" target="_blank">RLiveChat</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.kamychina.com/" title="https:&#x2F;&#x2F;www.kamychina.com&#x2F;" rel="noopener" target="_blank">Roadheader</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://tinycms.xyz/" title="https:&#x2F;&#x2F;tinycms.xyz&#x2F;" rel="noopener" target="_blank">TinyCMS</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313405/php%E5%86%85%E7%BD%AE%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4-time_out-file_get_contents-read_file/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313405/php%E5%86%85%E7%BD%AE%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4-time_out-file_get_contents-read_file/" class="post-title-link" itemprop="url">PHP内置访问资源的超时时间 time_out file_get_contents read_file</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-16 13:37:47" itemprop="dateCreated datePublished" datetime="2012-06-16T13:37:47+08:00">2012-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BD%AC%E8%BD%BD/" itemprop="url" rel="index"><span itemprop="name">转载</span></a>
        </span>
    </span>

  
    <span id="/313405/php%E5%86%85%E7%BD%AE%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4-time_out-file_get_contents-read_file/" class="post-meta-item leancloud_visitors" data-flag-title="PHP内置访问资源的超时时间 time_out file_get_contents read_file" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313405/php%E5%86%85%E7%BD%AE%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4-time_out-file_get_contents-read_file/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313405/php%E5%86%85%E7%BD%AE%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4-time_out-file_get_contents-read_file/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>提问<br>我循环用file_get_contents抓取一堆url，但总是会在不到第100个URL的时候停下，提示我：“Warning: file_get_contents(URL) [function.file-get-</p>
<p>contents]: failed to open stream: HTTP request failed! HTTP&#x2F;1.0 500 Read timed out<br>in D:\website\extra.php on line 65”</p>
<p>我在程序的开始已经有set_time_limit(0);了啊，那上面的错误会是因为什么呢？</p>
<p>回答<br>set_time_limit只是设置你的PHP程序的超时时间，而不是file_get_contents函数读取URL的超时时间。<br>从警告信息来看，是被抓取的网页出现了服务器500错误，可能是他的程序出现超时了。</p>
<p>如果想改变file_get_contents的超时时间，可以用resource $context的timeout参数：<br>$opts &#x3D; array(<br>‘http’&#x3D;&gt;array(<br>    ‘method’&#x3D;&gt;”GET”,<br>    ‘timeout’&#x3D;&gt;60,<br>   )<br>);</p>
<p>$context &#x3D; stream_context_create($opts);</p>
<p>$html &#x3D;file_get_contents(‘<a href="http://www.example.com/">http://www.example.com</a>‘, false, $context);<br>fpassthru($fp);</p>
<p>参考资料：<a href="http://cn.php.net/manual/en/context.http.php">http://cn.php.net/manual/en/context.http.php</a></p>
<p>这样readfile函数的超时时间就设置成了10秒，如果你够细心的话，还会发现数组中还有一些其他的配置，第一维中的http是指定使用的网络协议，二维中的method批的是http的请求方法get,post,head等，timeout就是超时时间了。我想很多人会使用php内置的file_get_contents函数来下载网页，因为这个函数使用起来够简单。很多人也都很简单的使用它，只要传递一个链接它就可以自动的发送get请求，并将网页内容下载下来。如果比较复杂的情况，比如使用POST请求，使用代理下载，定义User-Agent等等，这时很多人就会认为这个函数做不了这样的事情，就会选择其他方式，如curl，来实现。实际上，这些事情file_get_contents也可以做到，</p>
<p>就是通过它的第三个参数，设置http请求的context。</p>
<p>支持的设置和使用方式见官方说明：<a href="http://www.php.net/manual/en/context.http.php">http://www.php.net/manual/en/context.http.php</a></p>
<p>附：目前我知道的支持context参数的php内置函数有file_get_contents,file_put_contents,readfile,file,fopen,copy（估计这一类的函数都支持吧，待确认）。</p>
<p>function Post($url, $post &#x3D; null)<br>{<br>$context &#x3D; array();</p>
<p>if (is_array($post))<br>{<br>ksort($post);</p>
<p>$context[‘http’] &#x3D; array<br>(</p>
<p>‘timeout’&#x3D;&gt;60,<br>‘method’ &#x3D;&gt; ‘POST’,<br>‘content’ &#x3D;&gt; http_build_query($post, ‘’, ‘&amp;’),<br>);<br>}</p>
<p>return file_get_contents($url, false, stream_context_create($context));<br>}</p>
<p>$data &#x3D; array<br>(<br>‘name’ &#x3D;&gt; ‘test’,<br>‘email’ &#x3D;&gt; ‘<a href="mailto:&#116;&#x65;&#x73;&#x74;&#64;&#x67;&#x6d;&#97;&#105;&#108;&#x2e;&#x63;&#x6f;&#x6d;">test@gmail.com</a>‘,<br>‘submit’ &#x3D;&gt; ‘submit’,<br>);</p>
<p>echo Post(‘<a href="http://www.yifu.info/">http://www.yifu.info</a>‘, $data);</p>
<p>OK , 上面函数完美了，既解决了超时控制又解决了Post传值。再配合康盛的改良版RC4加密解密算法，做一个安全性很高的webservice就简单多了。</p>
<p>原文：<a href="http://blog.csdn.net/adparking/article/details/7231849">http://blog.csdn.net/adparking/article/details/7231849</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313420/wordpress%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9Curl%E9%87%8D%E5%AE%9A%E5%90%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313420/wordpress%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9Curl%E9%87%8D%E5%AE%9A%E5%90%91/" class="post-title-link" itemprop="url">wordpress搜索结果url重定向</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-13 09:25:20" itemprop="dateCreated datePublished" datetime="2012-06-13T09:25:20+08:00">2012-06-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Wordpress%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Wordpress学习</span></a>
        </span>
    </span>

  
    <span id="/313420/wordpress%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9Curl%E9%87%8D%E5%AE%9A%E5%90%91/" class="post-meta-item leancloud_visitors" data-flag-title="wordpress搜索结果url重定向" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313420/wordpress%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9Curl%E9%87%8D%E5%AE%9A%E5%90%91/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313420/wordpress%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9Curl%E9%87%8D%E5%AE%9A%E5%90%91/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>]!=<span class="string">&#x27;&#x27;</span>)&#123; </span><br><span class="line"><span class="variable">$change</span> = <span class="keyword">array</span>(<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27; &#x27;</span>); </span><br><span class="line"><span class="variable">$kwds</span> = <span class="title function_ invoke__">strtolower</span>( <span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>] );</span><br><span class="line"><span class="variable">$kwds</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$kwds</span>);</span><br><span class="line"><span class="variable">$searchredirect</span> = <span class="title function_ invoke__">get_settings</span>(<span class="string">&#x27;home&#x27;</span>) . <span class="string">&#x27;/search/&#x27;</span> . <span class="title function_ invoke__">str_replace</span>(<span class="variable">$change</span>, <span class="string">&#x27;-&#x27;</span> ,<span class="variable">$kwds</span>). <span class="string">&#x27;/&#x27;</span>; </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;HTTP/1.1 301 Moved Permanently&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>( <span class="string">&quot;Location: <span class="subst">$searchredirect</span>&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313417/cant-init-tc-log-aborting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313417/cant-init-tc-log-aborting/" class="post-title-link" itemprop="url">Can't init tc log Aborting</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-12 14:01:31" itemprop="dateCreated datePublished" datetime="2012-06-12T14:01:31+08:00">2012-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/313417/cant-init-tc-log-aborting/" class="post-meta-item leancloud_visitors" data-flag-title="Can't init tc log Aborting" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313417/cant-init-tc-log-aborting/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313417/cant-init-tc-log-aborting/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天的VPS非常卡，不小心输入个命令 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld  然后卡的不动了，我重启了。结果mysql就启动不了了。</p>
<p>查看 <code>tail -n 50 /usr/local/mysql/data/***.err  </code> 提示  </p>
<pre><code>Can&#39;t init tc log Aborting ， Failed to open log，   File &#39;./mysql-bin.000023&#39; not found
</code></pre>
<p>解决办法： </p>
<p>问题出在mysql-bin.0000023上。</p>
<p>mysql5运行一段时间，在mysql&#x2F;data目录下出现一堆类似mysql-bin.000***的文件，从mysql-bin.000001开始一直排列下来，有的占用了大量硬盘空间，高达上百兆，我的高达20多G。 这些文件是MySQL的事务日志log-bin。删除也是没事的。logbin主要是用来做回滚和增量备份的。 还可以在my.ini里把log-bin注释掉，就不产生日志文件了。 </p>
<p><code>vi /etc/my.cnf</code><br>配置中的log-bin注释掉，</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#log-bin=mysql-bin </span></span><br></pre></td></tr></table></figure>

<p> 果然问题解决</p>
<p>log-bin&#x3D;mysql-bin配置与主从配置有关，并且它记录了所有数据库的操作，用于灾难恢复，所以注释掉它也是有一定风险的，需要定时备份数据库！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313408/wordpress-mu-%E8%BF%81%E7%A7%BB%E5%9F%9F%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313408/wordpress-mu-%E8%BF%81%E7%A7%BB%E5%9F%9F%E5%90%8D/" class="post-title-link" itemprop="url">wordpress mu 迁移域名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-10 05:35:03" itemprop="dateCreated datePublished" datetime="2012-06-10T05:35:03+08:00">2012-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Wordpress%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Wordpress学习</span></a>
        </span>
    </span>

  
    <span id="/313408/wordpress-mu-%E8%BF%81%E7%A7%BB%E5%9F%9F%E5%90%8D/" class="post-meta-item leancloud_visitors" data-flag-title="wordpress mu 迁移域名" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313408/wordpress-mu-%E8%BF%81%E7%A7%BB%E5%9F%9F%E5%90%8D/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313408/wordpress-mu-%E8%BF%81%E7%A7%BB%E5%9F%9F%E5%90%8D/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>迁移时可以把原先的数据库导出为.sql格式，然后再用notepad++或其它工具替换里面的所有域名为自己的新域名比如，替换crusherknowledge.com为crushertech.net ，这样你再导入新的数据库，这样便完成的数据库的迁移工作。</p>
<p>创建数据库并为新数据库添加用户名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE <span class="string">&#x27;newdbname&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;passwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="string">&#x27;newdbname&#x27;</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;usrname&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;passwd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>如果你没有这样做，这些表中的内容你需要修改。可以先修改wp_options, wp_blogs, wp_site 这几个重要的。然后再把所有的wp_N_posts和wp_N_options表中的内容替换下。</p>
<p>主要修改的表为：<br>wp_N_posts (N为每个博客的ID，下同)<br>wp_N_options<br>wp_blogs<br>wp_site</p>
<p>网站迁移好之后需要重定向，这个比较重要。如果你的wpu是二级域名格式的。可以这样重定向到新域名：</p>
<p>下面的例子为 <a href="http://crusherknowledge.com/">http://crusherknowledge.com</a> 重定向到 <a href="http://crushertech.net/">http://crushertech.net</a> </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">RewriteEngine</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteCond</span> <span class="variable">%&#123;HTTP_HOST&#125;</span> !^www\.crusherknowledge.com\.com</span><br><span class="line"><span class="attribute">RewriteCond</span> <span class="variable">%&#123;HTTP_HOST&#125;</span> ^(.*)\.crusherknowledge\.com$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute">RewriteRule</span> ^(.*)$ http://%<span class="number">1</span>.crushertech\.net/$<span class="number">1</span><span class="meta"> [R=301,L]</span></span><br><span class="line"><span class="attribute">RewriteCond</span> <span class="variable">%&#123;HTTP_HOST&#125;</span> ^crusherknowledge.com$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute">RewriteRule</span> ^(.*)$ http://crushertech.net/$<span class="number">1</span><span class="meta"> [L,R=301]</span></span><br></pre></td></tr></table></figure>

<p>这样便和原先的网站一模一样，只是域名不同而已。</p>
<p>了解更多关于<code>htaccess</code>的重写规则请访问：<br><a href="http://man.chinaunix.net/newsoft/Apache2.2_chinese_manual/mod/mod_rewrite.html">http://man.chinaunix.net/newsoft/Apache2.2_chinese_manual/mod/mod_rewrite.html</a></p>
<p>从google中删除你网页的索引：</p>
<p><a href="https://sites.google.com/site/webmasterhelpforum/zh-cn/how-to-remove-and-block-content-from-search-result">https://sites.google.com/site/webmasterhelpforum/zh-cn/how-to-remove-and-block-content-from-search-result</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313406/php-%E4%BF%AE%E5%A4%8D%E6%9C%AA%E6%AD%A3%E5%B8%B8%E5%85%B3%E9%97%AD%E7%9A%84-html-%E6%A0%87%E7%AD%BE%EF%BC%88%E6%94%AF%E6%8C%81%E5%B5%8C%E5%A5%97%E5%92%8C%E5%B0%B1%E8%BF%91%E9%97%AD%E5%90%88%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313406/php-%E4%BF%AE%E5%A4%8D%E6%9C%AA%E6%AD%A3%E5%B8%B8%E5%85%B3%E9%97%AD%E7%9A%84-html-%E6%A0%87%E7%AD%BE%EF%BC%88%E6%94%AF%E6%8C%81%E5%B5%8C%E5%A5%97%E5%92%8C%E5%B0%B1%E8%BF%91%E9%97%AD%E5%90%88%EF%BC%89/" class="post-title-link" itemprop="url">PHP修复未正常关闭的HTML标签（支持嵌套和就近闭合）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-09 05:04:54" itemprop="dateCreated datePublished" datetime="2012-06-09T05:04:54+08:00">2012-06-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BD%AC%E8%BD%BD/" itemprop="url" rel="index"><span itemprop="name">转载</span></a>
        </span>
    </span>

  
    <span id="/313406/php-%E4%BF%AE%E5%A4%8D%E6%9C%AA%E6%AD%A3%E5%B8%B8%E5%85%B3%E9%97%AD%E7%9A%84-html-%E6%A0%87%E7%AD%BE%EF%BC%88%E6%94%AF%E6%8C%81%E5%B5%8C%E5%A5%97%E5%92%8C%E5%B0%B1%E8%BF%91%E9%97%AD%E5%90%88%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="PHP修复未正常关闭的HTML标签（支持嵌套和就近闭合）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313406/php-%E4%BF%AE%E5%A4%8D%E6%9C%AA%E6%AD%A3%E5%B8%B8%E5%85%B3%E9%97%AD%E7%9A%84-html-%E6%A0%87%E7%AD%BE%EF%BC%88%E6%94%AF%E6%8C%81%E5%B5%8C%E5%A5%97%E5%92%8C%E5%B0%B1%E8%BF%91%E9%97%AD%E5%90%88%EF%BC%89/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313406/php-%E4%BF%AE%E5%A4%8D%E6%9C%AA%E6%AD%A3%E5%B8%B8%E5%85%B3%E9%97%AD%E7%9A%84-html-%E6%A0%87%E7%AD%BE%EF%BC%88%E6%94%AF%E6%8C%81%E5%B5%8C%E5%A5%97%E5%92%8C%E5%B0%B1%E8%BF%91%E9%97%AD%E5%90%88%EF%BC%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * fixHtmlTag</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * HTML标签修复函数，此函数可以修复未正确闭合的 HTML 标签</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 由于不确定性因素太多，暂时提供两种模式“嵌套闭合模式”和</span></span><br><span class="line"><span class="comment"> * “就近闭合模式”，应该够用了。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 这两种模式是我为了解释清楚此函数的实现而创造的两个名词，</span></span><br><span class="line"><span class="comment"> * 只需明白什么意思就行。</span></span><br><span class="line"><span class="comment"> * 1，嵌套闭合模式，NEST，为默认的闭合方式。即 &quot;&lt;body&gt;&lt;div&gt;你好&quot;</span></span><br><span class="line"><span class="comment"> * 这样的 html 代码会被修改为 &quot;&lt;body&gt;&lt;div&gt;你好&lt;/div&gt;&lt;/body&gt;&quot;</span></span><br><span class="line"><span class="comment"> * 2，就近闭合模式，CLOSE，这种模式会将形如 &quot;&lt;p&gt;你好&lt;p&gt;为什么没有</span></span><br><span class="line"><span class="comment"> * 闭合呢&quot; 的代码修改为 &quot;&lt;p&gt;你好&lt;/p&gt;&lt;p&gt;为什么没有闭合呢&lt;/p&gt;&quot;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在嵌套闭合模式（默认，无需特殊传参）下，可以传入需要就近闭合的</span></span><br><span class="line"><span class="comment"> * 标签名，通过这种方式将类似 &quot;&lt;body&gt;&lt;p&gt;你好&lt;/p&gt;&lt;p&gt;我也好&quot; 转换为</span></span><br><span class="line"><span class="comment"> * &quot;&lt;body&gt;&lt;p&gt;你好&lt;/p&gt;&lt;p&gt;我也好&lt;/p&gt;&lt;/body&gt;&quot;的形式。</span></span><br><span class="line"><span class="comment"> * 传参时索引需要按照如下方式写，不需要修改的设置可以省略</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 					$param = array(</span></span><br><span class="line"><span class="comment"> * 						&#x27;html&#x27; =&gt; &#x27;&#x27;,			//必填</span></span><br><span class="line"><span class="comment"> * 						&#x27;options&#x27; =&gt; array(</span></span><br><span class="line"><span class="comment"> * 							&#x27;tagArray&#x27; =&gt; array();</span></span><br><span class="line"><span class="comment"> * 							&#x27;type&#x27; =&gt; &#x27;NEST&#x27;,</span></span><br><span class="line"><span class="comment"> * 							&#x27;length&#x27; =&gt; null,</span></span><br><span class="line"><span class="comment"> * 							&#x27;lowerTag&#x27; =&gt; TRUE,</span></span><br><span class="line"><span class="comment"> * 							&#x27;XHtmlFix&#x27; =&gt; TRUE,</span></span><br><span class="line"><span class="comment"> * 							)</span></span><br><span class="line"><span class="comment"> * 						);</span></span><br><span class="line"><span class="comment"> * 					fixHtmlTag($param);</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 上面索引对应的值含义如下</span></span><br><span class="line"><span class="comment"> * string 	$html	 需要修改的 html 代码</span></span><br><span class="line"><span class="comment"> * array  	$tagArray 当为嵌套模式时，需要就近闭合的标签数组</span></span><br><span class="line"><span class="comment"> * string 	$type	 模式名，目前支持 NEST 和 CLOSE 两种模式，如果设置为 CLOSE，将会忽略参数 $tagArray 的设置，而全部就近闭合所有标签</span></span><br><span class="line"><span class="comment"> * ini 		$length   如果希望截断一定长度，可以在此赋值，此长度指的是字符串长度</span></span><br><span class="line"><span class="comment"> * bool 	$lowerTag 是否将代码中的标签全部转换为小写，默认为 TRUE</span></span><br><span class="line"><span class="comment"> * bool 	$XHtmlFix 是否处理不符合 XHTML 规范的标签，即将 &lt;br&gt; 转换为 &lt;br /&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  IT不倒翁 &lt;itbudaoweng<span class="doctag">@gmail</span>.com&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 0.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span>  	http://yungbo.com IT不倒翁</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> 	http://enenba.com/?post=19 某某</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> 	array 	$param 	  数组参数，需要赋予特定的索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 	string 	$result	  经过处理后的 html 代码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 	2012-04-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fixHtmlTag</span>(<span class="params"><span class="variable">$param</span> = <span class="keyword">array</span>(<span class="params"></span>)</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//参数的默认值</span></span><br><span class="line">	<span class="variable">$html</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$tagArray</span> = <span class="keyword">array</span>();</span><br><span class="line">	<span class="variable">$type</span> = <span class="string">&#x27;NEST&#x27;</span>;</span><br><span class="line">	<span class="variable">$length</span> = <span class="literal">null</span>;</span><br><span class="line">	<span class="variable">$lowerTag</span> = <span class="literal">TRUE</span>;</span><br><span class="line">	<span class="variable">$XHtmlFix</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//首先获取一维数组，即 $html 和 $options （如果提供了参数）</span></span><br><span class="line">	<span class="title function_ invoke__">extract</span>(<span class="variable">$param</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//如果存在 options，提取相关变量</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$options</span>)) &#123;</span><br><span class="line">		<span class="title function_ invoke__">extract</span>(<span class="variable">$options</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$result</span>   = <span class="string">&#x27;&#x27;</span>; <span class="comment">//最终要返回的 html 代码</span></span><br><span class="line">	<span class="variable">$tagStack</span> = <span class="keyword">array</span>(); <span class="comment">//标签栈，用 array_push() 和 array_pop() 模拟实现</span></span><br><span class="line">	<span class="variable">$contents</span> = <span class="keyword">array</span>(); <span class="comment">//用来存放 html 标签</span></span><br><span class="line">	<span class="variable">$len</span>	  = <span class="number">0</span>; <span class="comment">//字符串的初始长度</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置闭合标记 $isClosed，默认为 TRUE, 如果需要就近闭合，成功匹配开始标签后其值为 false,成功闭合后为 true</span></span><br><span class="line">	<span class="variable">$isClosed</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//将要处理的标签全部转为小写</span></span><br><span class="line">	<span class="variable">$tagArray</span> = <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;strtolower&#x27;</span>, <span class="variable">$tagArray</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//“合法”的单闭合标签</span></span><br><span class="line">	<span class="variable">$singleTagArray</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;&lt;meta&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;&lt;link&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;&lt;base&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;&lt;br&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;&lt;hr&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;&lt;input&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;&lt;img&#x27;</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//校验匹配模式 $type，默认为 NEST 模式</span></span><br><span class="line">	<span class="variable">$type</span> = <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$type</span>);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$type</span>, <span class="keyword">array</span>(<span class="string">&#x27;NEST&#x27;</span>, <span class="string">&#x27;CLOSE&#x27;</span>))) &#123;</span><br><span class="line">		<span class="variable">$type</span> = <span class="string">&#x27;NEST&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//以一对 &lt; 和 &gt; 为分隔符，将原 html 标签和标签内的字符串放到数组中</span></span><br><span class="line">	<span class="variable">$contents</span> = <span class="title function_ invoke__">preg_split</span>(<span class="string">&quot;/(&lt;[^&gt;]+?&gt;)/si&quot;</span>, <span class="variable">$html</span>, -<span class="number">1</span>, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">foreach</span> (<span class="variable">$contents</span> <span class="keyword">as</span> <span class="variable">$tag</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="string">&#x27;&#x27;</span> == <span class="title function_ invoke__">trim</span>(<span class="variable">$tag</span>)) &#123;</span><br><span class="line">			<span class="variable">$result</span> .= <span class="variable">$tag</span>;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//匹配标准的单闭合标签，如&lt;br /&gt;</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&lt;(\w+)[^\/&gt;]*?\/&gt;/si&quot;</span>, <span class="variable">$tag</span>)) &#123;</span><br><span class="line">			<span class="variable">$result</span> .= <span class="variable">$tag</span>;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//匹配开始标签，如果是单标签则出栈</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&lt;(\w+)[^\/&gt;]*?&gt;/si&quot;</span>, <span class="variable">$tag</span>, <span class="variable">$match</span>)) &#123;</span><br><span class="line">			<span class="comment">//如果上一个标签没有闭合，并且上一个标签属于就近闭合类型</span></span><br><span class="line">			<span class="comment">//则闭合之，上一个标签出栈</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//如果标签未闭合</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable">$isClosed</span>) &#123;</span><br><span class="line">				<span class="comment">//就近闭合模式，直接就近闭合所有的标签</span></span><br><span class="line">				<span class="keyword">if</span> (<span class="string">&#x27;CLOSE&#x27;</span> == <span class="variable">$type</span>) &#123;</span><br><span class="line">					<span class="variable">$result</span> .= <span class="string">&#x27;&lt;/&#x27;</span> . <span class="title function_ invoke__">end</span>(<span class="variable">$tagStack</span>) . <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">					<span class="title function_ invoke__">array_pop</span>(<span class="variable">$tagStack</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//默认的嵌套模式，就近闭合参数提供的标签</span></span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$tagStack</span>), <span class="variable">$tagArray</span>)) &#123;</span><br><span class="line">						<span class="variable">$result</span> .= <span class="string">&#x27;&lt;/&#x27;</span> . <span class="title function_ invoke__">end</span>(<span class="variable">$tagStack</span>) . <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">						<span class="title function_ invoke__">array_pop</span>(<span class="variable">$tagStack</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//如果参数 $lowerTag 为 TRUE 则将标签名转为小写</span></span><br><span class="line">			<span class="variable">$matchLower</span> = <span class="variable">$lowerTag</span> == <span class="literal">TRUE</span> ? <span class="title function_ invoke__">strtolower</span>(<span class="variable">$match</span>[<span class="number">1</span>]) : <span class="variable">$match</span>[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">			<span class="variable">$tag</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;&#x27;</span> . <span class="variable">$match</span>[<span class="number">1</span>], <span class="string">&#x27;&lt;&#x27;</span> . <span class="variable">$matchLower</span>, <span class="variable">$tag</span>);</span><br><span class="line">			<span class="comment">//开始新的标签组合</span></span><br><span class="line">			<span class="variable">$result</span> .= <span class="variable">$tag</span>;</span><br><span class="line">			<span class="title function_ invoke__">array_push</span>(<span class="variable">$tagStack</span>, <span class="variable">$matchLower</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//如果属于约定的的单标签，则闭合之并出栈</span></span><br><span class="line">			<span class="keyword">foreach</span> (<span class="variable">$singleTagArray</span> <span class="keyword">as</span> <span class="variable">$singleTag</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$tag</span>, <span class="variable">$singleTag</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">					<span class="keyword">if</span> (<span class="variable">$XHtmlFix</span> == <span class="literal">TRUE</span>) &#123;</span><br><span class="line">						<span class="variable">$tag</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27; /&gt;&#x27;</span>, <span class="variable">$tag</span>);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="title function_ invoke__">array_pop</span>(<span class="variable">$tagStack</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//就近闭合模式，状态变为未闭合</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="string">&#x27;CLOSE&#x27;</span> == <span class="variable">$type</span>) &#123;</span><br><span class="line">				<span class="variable">$isClosed</span> = <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//默认的嵌套模式，如果标签位于提供的 $tagArray 里，状态改为未闭合</span></span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$matchLower</span>, <span class="variable">$tagArray</span>)) &#123;</span><br><span class="line">					<span class="variable">$isClosed</span> = <span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">unset</span>(<span class="variable">$matchLower</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//匹配闭合标签，如果合适则出栈</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&lt;\/(\w+)[^\/&gt;]*?&gt;/si&quot;</span>, <span class="variable">$tag</span>, <span class="variable">$match</span>)) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//如果参数 $lowerTag 为 TRUE 则将标签名转为小写</span></span><br><span class="line">			<span class="variable">$matchLower</span> = <span class="variable">$lowerTag</span> == <span class="literal">TRUE</span> ? <span class="title function_ invoke__">strtolower</span>(<span class="variable">$match</span>[<span class="number">1</span>]) : <span class="variable">$match</span>[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (<span class="title function_ invoke__">end</span>(<span class="variable">$tagStack</span>) == <span class="variable">$matchLower</span>) &#123;</span><br><span class="line">				<span class="variable">$isClosed</span> = <span class="literal">true</span>; <span class="comment">//匹配完成，标签闭合</span></span><br><span class="line">				<span class="variable">$tag</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;/&#x27;</span> . <span class="variable">$match</span>[<span class="number">1</span>], <span class="string">&#x27;&lt;/&#x27;</span> . <span class="variable">$matchLower</span>, <span class="variable">$tag</span>);</span><br><span class="line">				<span class="variable">$result</span> .= <span class="variable">$tag</span>;</span><br><span class="line">				<span class="title function_ invoke__">array_pop</span>(<span class="variable">$tagStack</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">unset</span>(<span class="variable">$matchLower</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//匹配注释，直接连接 $result</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&lt;!--.*?--&gt;/si&quot;</span>, <span class="variable">$tag</span>)) &#123;</span><br><span class="line">			<span class="variable">$result</span> .= <span class="variable">$tag</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//将字符串放入 $result ，顺便做下截断操作</span></span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$length</span>) || <span class="variable">$len</span> + <span class="title function_ invoke__">mb_strlen</span>(<span class="variable">$tag</span>) &lt; <span class="variable">$length</span>) &#123;</span><br><span class="line">				<span class="variable">$result</span> .= <span class="variable">$tag</span>;</span><br><span class="line">				<span class="variable">$len</span> += <span class="title function_ invoke__">mb_strlen</span>(<span class="variable">$tag</span>);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="variable">$str</span> = <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$tag</span>, <span class="number">0</span>, <span class="variable">$length</span> - <span class="variable">$len</span> + <span class="number">1</span>);</span><br><span class="line">				<span class="variable">$result</span> .= <span class="variable">$str</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//如果还有将栈内的未闭合的标签连接到 $result</span></span><br><span class="line">	<span class="keyword">while</span> (!<span class="keyword">empty</span>(<span class="variable">$tagStack</span>)) &#123;</span><br><span class="line">		<span class="variable">$result</span> .= <span class="string">&#x27;&lt;/&#x27;</span> . <span class="title function_ invoke__">array_pop</span>(<span class="variable">$tagStack</span>) . <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="http://yungbo.com/php/php-fix-unmachted-html-tags-no-phptidy-extension.html">http://yungbo.com/php/php-fix-unmachted-html-tags-no-phptidy-extension.html</a></p>
<p><a href="http://blog.csdn.net/iseagold/article/details/5484904">http://blog.csdn.net/iseagold/article/details/5484904</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313403/win7%E5%8F%96%E5%BE%97%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313403/win7%E5%8F%96%E5%BE%97%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/" class="post-title-link" itemprop="url">win7取得管理员权限</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-08 13:11:27" itemprop="dateCreated datePublished" datetime="2012-06-08T13:11:27+08:00">2012-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">个人日志</span></a>
        </span>
    </span>

  
    <span id="/313403/win7%E5%8F%96%E5%BE%97%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/" class="post-meta-item leancloud_visitors" data-flag-title="win7取得管理员权限" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313403/win7%E5%8F%96%E5%BE%97%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313403/win7%E5%8F%96%E5%BE%97%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>把下面文件保存为文本文件，然后把扩展名txt改为reg . 双击文件导入即可，如果装了360会提示你，允许就行了。</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version <span class="number">5.00</span></span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\runas]</span><br><span class="line">@<span class="operator">=</span><span class="string">&quot;管理员取得所有权&quot;</span></span><br><span class="line"><span class="string">&quot;NoWorkingDirectory&quot;</span><span class="operator">=</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\runas\command]</span><br><span class="line">@<span class="operator">=</span><span class="string">&quot;cmd.exe /c takeown /f \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; &amp;amp;&amp;amp; icacls \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /grant administrators:F&quot;</span></span><br><span class="line"><span class="string">&quot;IsolatedCommand&quot;</span><span class="operator">=</span><span class="string">&quot;cmd.exe /c takeown /f \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; &amp;amp;&amp;amp; icacls \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /grant administrators:F&quot;</span></span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\exefile\shell\runas<span class="number">2</span>]</span><br><span class="line">@<span class="operator">=</span><span class="string">&quot;管理员取得所有权&quot;</span></span><br><span class="line"><span class="string">&quot;NoWorkingDirectory&quot;</span><span class="operator">=</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\exefile\shell\runas<span class="number">2</span>\command]</span><br><span class="line">@<span class="operator">=</span><span class="string">&quot;cmd.exe /c takeown /f \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; &amp;amp;&amp;amp; icacls \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /grant administrators:F&quot;</span></span><br><span class="line"><span class="string">&quot;IsolatedCommand&quot;</span><span class="operator">=</span><span class="string">&quot;cmd.exe /c takeown /f \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; &amp;amp;&amp;amp; icacls \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /grant administrators:F&quot;</span></span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\shell\runas]</span><br><span class="line">@<span class="operator">=</span><span class="string">&quot;管理员取得所有权&quot;</span></span><br><span class="line"><span class="string">&quot;NoWorkingDirectory&quot;</span><span class="operator">=</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\shell\runas\command]</span><br><span class="line">@<span class="operator">=</span><span class="string">&quot;cmd.exe /c takeown /f \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /r /d y &amp;amp;&amp;amp; icacls \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /grant administrators:F /t&quot;</span></span><br><span class="line"><span class="string">&quot;IsolatedCommand&quot;</span><span class="operator">=</span><span class="string">&quot;cmd.exe /c takeown /f \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /r /d y &amp;amp;&amp;amp; icacls \&quot;</span><span class="variable">%1</span>\<span class="string">&quot; /grant administrators:F /t&quot;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313396/php5-3-9%E4%B8%8B%E6%97%A0%E6%B3%95%E5%85%B3%E9%97%ADthread-safety/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313396/php5-3-9%E4%B8%8B%E6%97%A0%E6%B3%95%E5%85%B3%E9%97%ADthread-safety/" class="post-title-link" itemprop="url">php5.3.9下无法关闭thread safety</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-02 09:56:32" itemprop="dateCreated datePublished" datetime="2012-06-02T09:56:32+08:00">2012-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/313396/php5-3-9%E4%B8%8B%E6%97%A0%E6%B3%95%E5%85%B3%E9%97%ADthread-safety/" class="post-meta-item leancloud_visitors" data-flag-title="php5.3.9下无法关闭thread safety" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313396/php5-3-9%E4%B8%8B%E6%97%A0%E6%B3%95%E5%85%B3%E9%97%ADthread-safety/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313396/php5-3-9%E4%B8%8B%E6%97%A0%E6%B3%95%E5%85%B3%E9%97%ADthread-safety/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>/usr/local/php/bin/php -m</code></p>
<pre><code>Failed loading /usr/local/php/lib/php/extensions/no-debug-zts-20090626/ZendGuardLoader.so:  /usr/local/php/lib/php/extensions/no-debug-zts-20090626/ZendGuardLoader.so: undefined symbol: compiler_globals
</code></pre>
<p>这个错误是因为ZendGuardLoader 必须是要在Thread Safety Disable 的情况下才能使用。别无它法，只有重新编绎。但上网找了很久，没有答案解决。因为重新编绎的方法没一个管用的，无法使Thread Safety 关闭。  此问题不解决 Zend Optimizer  也便安装不了。</p>
<p>这个问题一直没有解决。回答的都不对。</p>
<p>说是要apache 编绎时 <code>--with-mpm=prefork </code> ，不对！<br>说是php重新编绎使用 <code>--disable-maintainer-zts</code> 或 <code>--disable-roxen-zts</code> 或 <code>--without-roxen</code> 或 <code>--disable-zts </code>， 不对！</p>
<p>这是国外一个人的提问，没有解决。<br><a href="http://www.experts-exchange.com/Web_Development/Web_Languages-Standards/PHP/PHP_Installation/Q_26890298.html">http://www.experts-exchange.com/Web_Development/Web_Languages-Standards/PHP/PHP_Installation/Q_26890298.html</a></p>
<p>等待解决。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313393/%E5%AE%89%E8%A3%85apc%E4%B8%BAphp%E5%8A%A0%E9%80%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313393/%E5%AE%89%E8%A3%85apc%E4%B8%BAphp%E5%8A%A0%E9%80%9F/" class="post-title-link" itemprop="url">安装apc为php加速</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-06-02 05:20:56" itemprop="dateCreated datePublished" datetime="2012-06-02T05:20:56+08:00">2012-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/313393/%E5%AE%89%E8%A3%85apc%E4%B8%BAphp%E5%8A%A0%E9%80%9F/" class="post-meta-item leancloud_visitors" data-flag-title="安装apc为php加速" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313393/%E5%AE%89%E8%A3%85apc%E4%B8%BAphp%E5%8A%A0%E9%80%9F/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313393/%E5%AE%89%E8%A3%85apc%E4%B8%BAphp%E5%8A%A0%E9%80%9F/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>Alternative PHP Cache</code>（APC）是 PHP 的一个免费公开的优化代码缓存。它用来提供免费，公开并且强健的架构来缓存和优化 PHP 的中间代码。</p>
<p>安装方法:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>pecl.php.net<span class="regexp">/get/</span>APC-<span class="number">3.1</span>.<span class="number">9</span>.tgz</span><br><span class="line">tar zxf APC-<span class="number">3.1</span>.<span class="number">9</span>.tgz</span><br><span class="line">cd APC-<span class="number">3.1</span>.<span class="number">9</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin/phpize</span><br><span class="line">.<span class="regexp">/configure --enable-apc --enable-apc-mmap --with-php-config=/u</span>sr<span class="regexp">/local/</span>php<span class="regexp">/bin/</span>php-config</span><br><span class="line">export LD_LIBRARY_PATH</span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>配置php.ini</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>lib/php.ini</span><br></pre></td></tr></table></figure>

<p>在末尾加上，根据PHP不同的版本，路径会有不同，请作修改。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[APC]</span></span><br><span class="line"><span class="attr">extension</span> = <span class="string">&quot;/usr/local/php/lib/php/extensions/no-debug-zts-20090626/apc.so&quot;</span></span><br><span class="line"><span class="attr">apc.enabled</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">apc.cache_by_default</span> = <span class="literal">on</span></span><br><span class="line"><span class="attr">apc.shm_segments</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">apc.shm_size</span> = <span class="number">32</span>M</span><br><span class="line"><span class="attr">apc.ttl</span> = <span class="number">600</span></span><br><span class="line"><span class="attr">apc.user_ttl</span> = <span class="number">600</span></span><br><span class="line"><span class="attr">apc.num_files_hint</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">apc.write_lock</span> = <span class="literal">On</span></span><br></pre></td></tr></table></figure>

<p>然后重启Apache</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">service httpd restart</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313389/wordpress-missed-schedule-fix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313389/wordpress-missed-schedule-fix/" class="post-title-link" itemprop="url">wordpress 任务丢失 定时发布文章 修复</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-05-31 08:13:56" itemprop="dateCreated datePublished" datetime="2012-05-31T08:13:56+08:00">2012-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Wordpress%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Wordpress学习</span></a>
        </span>
    </span>

  
    <span id="/313389/wordpress-missed-schedule-fix/" class="post-meta-item leancloud_visitors" data-flag-title="wordpress 任务丢失 定时发布文章 修复" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313389/wordpress-missed-schedule-fix/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313389/wordpress-missed-schedule-fix/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="修改-wp-includes-cron-php"><a href="#修改-wp-includes-cron-php" class="headerlink" title="修改 /wp-includes/cron.php"></a>修改 <code>/wp-includes/cron.php</code></h2><p>找到timeout &#x3D; 0.01 ， 把0.01改为5或更大值。默认是0.01秒，如果超进就出现了任务丢失现象。</p>
<h2 id="通过Mysql-进入phpmyadmin"><a href="#通过Mysql-进入phpmyadmin" class="headerlink" title="通过Mysql, 进入phpmyadmin"></a>通过Mysql, 进入phpmyadmin</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> wp_posts <span class="keyword">set</span> post_status <span class="operator">=</span> <span class="string">&#x27;publish&#x27;</span> <span class="keyword">where</span> post_date <span class="operator">&lt;</span> now();</span><br></pre></td></tr></table></figure>

<h2 id="通过插件"><a href="#通过插件" class="headerlink" title="通过插件"></a>通过插件</h2><p>WP Missed Schedule</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313385/lftp%E7%9A%84%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leadscloud">
      <meta itemprop="description" content="熟悉 Google SEO，外贸营销推广，这是我的个人博客，主要分享工作中的技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | leadscloud">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/313385/lftp%E7%9A%84%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">lftp的用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2012-05-29 05:33:57" itemprop="dateCreated datePublished" datetime="2012-05-29T05:33:57+08:00">2012-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-10 12:42:07" itemprop="dateModified" datetime="2025-04-10T12:42:07+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/313385/lftp%E7%9A%84%E7%94%A8%E6%B3%95/" class="post-meta-item leancloud_visitors" data-flag-title="lftp的用法" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/313385/lftp%E7%9A%84%E7%94%A8%E6%B3%95/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/313385/lftp%E7%9A%84%E7%94%A8%E6%B3%95/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>lftp支持tab自动补全</p>
<p>登陆方法</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lftp <span class="symbol">username:</span>password<span class="variable">@ftpaddr</span><span class="symbol">:port</span>(<span class="symbol">defalut:</span><span class="number">21</span>)</span><br><span class="line">lftp ftphost -u username</span><br></pre></td></tr></table></figure>

<p>!<br>可执行本地端 shell 中的命令, 如 !ls &#x2F;usr&#x2F;local&#x2F;bin&#x2F;<br>由於 lftp 并没有 lls(显示本地端档案列表的指令), 故可用 !ls 来替代。</p>
<p>下载：</p>
<p>  mget -C *.jpg  (把所有pdf文件以允许断点续传的方式下载，m代表multi)<br>  mirror aaa&#x2F;  (把aaa目录整个下载下来，子目录也会自动复制)<br>  pget -c -n 10 file.dat  (以最多10个线程并允许断点续传的方式下载file.dat，可以通过设置pget:default-n的值而使用默认值)</p>
<p>mirror OPTS remote [local]<br>下载整个目录(楼上的 get 只能用来抓档案)<br>-c 续传<br>-e 这个要小心一些, 比较远端和本地端的档案, 假如远端没有的, 就将本地端的档案删除, 也就是将本地端和远端资料同步。<br>-R 上传整个目录<br>-n 只下载较新的档案<br>-r 不用递回到目录中<br>–parallel&#x3D;n 同时下载 n 个档案(预设一次只下载一个)</p>
<p>上传：</p>
<p>  put,mput,都是对文件的上传操作，和get,mget类似。<br>  mirror -R local_dirname (把本地目录以迭代(包括子目录)方式上传到ftp site)</p>
<p>mv<br>将远端的 file1 改名为 file2</p>
<p>mrm<br>用 wildcard expansion 方式来删除远端档案</p>
<hr>
<p>lftp登陆<br>lftp登陆常用格式：<br>lftp [-d] [-e cmd] [-p port] [-u user[,pass]] [site]</p>
<p>[-d]<br>在debug mode运行。</p>
<p>[-e cmd]<br>执行指定的命令。</p>
<p>[-p port]<br>指定连接端口。</p>
<p>[-u user[,pass]]<br>登陆的用户名和密码。</p>
<p>[site]<br>FTP服务器地址。</p>
<p>例如：<br>lftp -p 21 -u admin,123456 ftp.aaa.com<br>表示使用用户名admin、密码123456登陆ftp.aaa.com这个站点，端口为21。</p>
<p>简便格式：<br>lftp user:password@site:port</p>
<p>例如：<br>lftp admin:<a href="mailto:&#x31;&#x32;&#51;&#x34;&#x35;&#54;&#64;&#x66;&#x74;&#x70;&#x2e;&#97;&#x61;&#x61;&#x2e;&#x63;&#x6f;&#109;">123456@ftp.aaa.com</a>:21<br>同样可以登陆。</p>
<p>随后就和其它命令行的ftp工具一样使用ftp内部命令进行控制。登陆后输入help可以查看支持的命令。</p>
<p>2、lftp的mirror命令<br>lftp登陆成功后，使用mirror命令用来备份文件。</p>
<p>将远程服务器上的文件备份到本地：<br>mirror [选项] [远程目录] [本地目录]</p>
<p>将本地文件备份到远程服务器上：<br>mirror -R [其它选项] [本地目录] [远程目录]</p>
<p>常用选项：<br>-c, –continue :如果镜像过程中连接中断，重新开始。<br>-e, –delete :删除不在远程服务器上的本地文件。<br>-n, –only-newer :下载远程服务器上的新文件，不能和-c一起用。<br>-R, –reverse :将本地文件镜像传输到远程服务器上。<br>-v, –verbose[&#x3D;level] :设置监视级别，范围0-3，0表示不输出，3表示输出全部。</p>
<p>举例：<br>    mirror -R –delete –only-newer –verbose &#x2F;home&#x2F;aaa.com &#x2F;public_html&#x2F;web&#x2F;aaa.com</p>
<p>将本地&#x2F;home&#x2F;aaa.com目录下的文件备份到远程服务器&#x2F;public_html&#x2F;web&#x2F;aaa.com目录。</p>
<pre><code>mirror --delete --only-newer --verbose /public_html/web /tmp
</code></pre>
<p>将远程服务器上&#x2F;public_html&#x2F;web目录下的文件备份到本地&#x2F;tmp目录下。</p>
<p>3、一条命令实现lftp登陆和mirror<br>使用lftp的-e选项，例如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lftp -e &quot;mirror -<span class="attribute">R</span> <span class="attr">--delete</span> <span class="attr">--only-newer</span> <span class="attr">--verbose</span> /home/aaa<span class="selector-class">.com</span> /public_html/web/aaa<span class="selector-class">.com</span>&quot; -<span class="selector-tag">p</span> <span class="number">21</span> -u admin,<span class="number">123456</span> ftp<span class="selector-class">.aaa</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>

<p>登陆后自动执行-e选项中的命令。</p>
<p>注意：如果远程FTP服务器是Pure-FTPd [privsep] [TLS]，执行命令会报错<br>WARNING: Certificate verification: Not trusted<br>WARNING: Certificate verification: The certificate’s owner does not match hostname ‘<a href="http://www.xxx.com/">www.xxx.com</a>‘<br>并且停留在[Making data connection…]，连接不上。</p>
<p>需要编辑lftp的&#x2F;etc&#x2F;lftp.conf：</p>
<p><code>vim /etc/lftp.conf</code></p>
<p>在最后加入：</p>
<pre><code>debug 3
set ftp:ssl-auth TLS-P
set ftp:use-feat no
</code></pre>
<p>再次尝试查看详情是否有报错。</p>
<p>PS：lftp默认使用PASV模式，如要使用PORT模式，登陆后执行set ftp:passive off，或者直接将其加入到&#x2F;etc&#x2F;lftp.conf中。</p>
<p>4、lftp多线程下载</p>
<p>lftp还可以做为一个多线程下载工具。</p>
<p>常用选项：<br>pget -n :设置使用线程数。<br>-c :断点续传。</p>
<p>举例：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lftp -<span class="keyword">c</span> <span class="string">&quot;pget -n 10 http://sourceforge.net/projects/kvm/files/qemu-kvm/1.2.0/qemu-kvm-1.2.0.tar.gz&quot;</span></span><br></pre></td></tr></table></figure>

<p>5、lftp使用问题<br>1）使用lftp的mirror命令备份时报550错<br><code>rm: Access failed: 550 dirname: Directory not empty</code></p>
<p>在lftp命令开头添加：<br><code>set ftp:list-options -a</code><br>是因为该文件夹下有隐藏文件，服务器默认不显示，所以删不掉。</p>
<p>2）设置lftp超时时间和重试次数<br>在lftp命令开头添加：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="built_in">net</span>:timeout <span class="number">10</span>;<span class="built_in">set</span> <span class="built_in">net</span>:max-retries <span class="number">2</span>;<span class="built_in">set</span> <span class="built_in">net</span>:reconnect-interval-base <span class="number">5</span>;<span class="built_in">set</span> <span class="built_in">net</span>:reconnect-interval-multiplier <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<pre><code>lftp -e &quot;set net:timeout 10;set net:max-retries 2;set net:reconnect-interval-base 5;set net:reconnect-interval-multiplier 1;set ftp:list-options -a;mirror -R --delete --only-newer --verbose /home/aaa.com /public_html/web/aaa.com&quot; -p 21 -u admin,123456 ftp.demo.com
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/24/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/46/">46</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/26/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ray</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/leadscloud" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.24.0/algoliasearch-lite.umd.js" integrity="sha256-b2n6oSgG4C1stMT/yc/ChGszs9EY/Mhs6oltEjQbFCQ=" crossorigin="anonymous"></script><script src="/js/third-party/search/algolia-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"ePPAQV9hFzcbhOaQvvtyjTnw-gzGzoHsz","app_key":"GLniGVXsSMGBjTmaiI4wleaF","server_url":"https://leancloud.tinycms.xyz","security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>




<script class="next-config" data-name="valine" type="application/json">{"enable":true,"appId":"ePPAQV9hFzcbhOaQvvtyjTnw-gzGzoHsz","appKey":"GLniGVXsSMGBjTmaiI4wleaF","serverURLs":"https://leancloud.tinycms.xyz","placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-cn","visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":[],"el":"#valine-comments","path":"/page/25/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.valine.el)
    .then(() => NexT.utils.getScript(
      'https://fastly.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js',
      { condition: window.Valine }
    ))
    .then(() => {
      new Valine(CONFIG.valine);
    });
});
</script>

</body>
</html>
